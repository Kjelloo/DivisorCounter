kind: pipeline
type: docker
name: ci

steps:
  - name: build
    image: mcr.microsoft.com/dotnet/sdk
    commands:
      - dotnet build
      - dotnet publish -c Release -o out
  - name: test
    image: mcr.microsoft.com/dotnet/sdk
    volumes:
      - name: dockersock
        path: /var/run
    commands:
      - dotnet test
  - name: deliver
    image: docker:dind
    commands: 
      - sleep 5
      - docker compose up -d

node:
  runner: drone-runner-1

services:
  - name: docker
    image: docker:dind
    privileged: true
    volumes:
      - name: dockersock
        path: /var/run
        
volumes:
  - name: dockersock
    temp: {}